<?xml version="1.0" encoding="utf-8"?>
<ModalBox:ModalBoxBase xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" xmlns:mx="library://ns.adobe.com/flex/mx"
					   width="380" height="420"
					   initialize="initializeHandler(event)"
					   xmlns:ModalBox="UI.Box.ModalBox.*" xmlns:Box="UI.Box.*" xmlns:Label="UI.Label.*" xmlns:MyPhotos="Platform.TopBar.Settings.MyPhotos.*" xmlns:MyCredits="Platform.TopBar.Settings.MyCredits.*" xmlns:flexws="services.flexws.*">
	<fx:Metadata>
		[Event(name=CLOSE, type="flash.events.Event")]
	</fx:Metadata>
	<fx:Script>
		<![CDATA[
			import Handler.LocHandler;
			import Handler.SesHandler;
			
			import UI.Button.ButtonBase;
			import UI.Photo.PhotoBase;
			
			import Handler.LocGeneratedCode;
			import Utils.AS3.Serializer;
			import Utils.Log.Logger;
			
			import mx.events.FlexEvent;
			import mx.managers.CursorManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			protected function initializeHandler(event:FlexEvent):void
			{
				boxBC.ShowCloseButton();
				boxBC.ShowTitle(LocHandler.GS(LocGeneratedCode.My_Credits) + " (" + SesHandler.Instance.Session.Me.CreditsBalance + ")");
			}
			public override function Init(p_buttonOpener:ButtonBase, p_photoOpener:PhotoBase):void
			{
				super.Init(p_buttonOpener, p_photoOpener);
				DoShowBox(boxCanvas);
			}
			public override function Dispose():void
			{
				super.Dispose();
				
				if (boxBC != null)
				{
					boxBC.Dispose();
				}
				if (boxCanvas != null)
				{
					boxCanvas.Dispose();
				}
				
				if (myCreditsModalBoxList != null)
				{
					myCreditsModalBoxList.Dispose();
					myCreditsModalBoxList = null;
				}
			}
			
			public function GetData():void
			{
				callResponderSessionFillCredits.token = wsFlex.SessionFillCredits(SesHandler.Instance.Session.SID);
			}
			private function callResponderSessionFillCredits_resultHandler(event:ResultEvent):void
			{
				SesHandler.Instance.Session.Credits.Fill(Serializer.DeSerializeArrayCollection(event, "T_USER_CREDIT"));
				SesHandler.Instance.Session.Members.Fill(Serializer.DeSerializeArrayCollection(event, "Table1"));
				SesHandler.Instance.Session.Members.FillMultipleMembersPhotos(Serializer.DeSerializeArrayCollection(event, "Table2"));
				SesHandler.Instance.Session.Members.FillMultipleMembersLikes(Serializer.DeSerializeArrayCollection(event, "Table3"));
				SesHandler.Instance.Session.Members.FillMultipleMembersFriends(Serializer.DeSerializeArrayCollection(event, "Table4"));
				SesHandler.Instance.Session.Members.FillMultipleMembersComms(Serializer.DeSerializeArrayCollection(event, "Table5"));
				SesHandler.Instance.Session.Members.CalculateDatePercentage();
				
				DoPaint();
			}
			private function callResponderSessionFillCredits_faultHandler(event:FaultEvent):void
			{
				dispatchEvent(new Event(CLOSE));
			}
			
			private function DoPaint():void
			{
				DoShowContent(boxContent);
				myCreditsModalBoxList.Init(SesHandler.Instance.Session.Credits);
				myCreditsModalBoxList.DoFill();
			}
		]]>
	</fx:Script>
	<fx:Declarations>
		<s:CallResponder id="callResponderSessionFillCredits"
						 result="Logger.Instance.WriteEvent(event, flash.utils.getQualifiedClassName(this));CursorManager.removeBusyCursor();callResponderSessionFillCredits_resultHandler(event)"
						 fault="Logger.Instance.WriteFaultEvent(event, flash.utils.getQualifiedClassName(this));CursorManager.removeBusyCursor();callResponderSessionFillCredits_faultHandler(event)"/>
		<flexws:FlexWS id="wsFlex"
					   fault="Logger.Instance.WriteFaultEvent(event, flash.utils.getQualifiedClassName(this));cursorManager.removeBusyCursor();callResponderSessionFillCredits_faultHandler(event)"/>
	</fx:Declarations>
	<Box:BoxCanvas id="boxCanvas" width="100%" height="100%">
		<Box:BoxGroup id="boxGroup" width="100%" height="100%">
			<Box:BoxBC id="boxBC" width="100%" height="100%" CLOSE="dispatchEvent(new Event(CLOSE))">
				<Box:BoxContent id="boxContent" width="100%" height="100%">
					<mx:Spacer height="15"/>
					<MyCredits:MyCreditsModalBoxList id="myCreditsModalBoxList" width="100%" height="100%" m_iPaintedListItemCount="12" m_iPaintedListItemStpes="12"/>
				</Box:BoxContent>
			</Box:BoxBC>
		</Box:BoxGroup>
	</Box:BoxCanvas>
</ModalBox:ModalBoxBase>