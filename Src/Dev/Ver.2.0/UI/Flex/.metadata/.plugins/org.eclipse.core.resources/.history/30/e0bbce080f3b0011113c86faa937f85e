<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" xmlns:mx="library://ns.adobe.com/flex/mx"
		   width="100%" height="100%">
	<fx:Metadata>
		[Event(name=CLOSE, type="flash.events.Event")]
	</fx:Metadata>
	<fx:Script>
		<![CDATA[
			import Utils.AS3.ResultCode;
			import Utils.Log.Logger;
			
			import mx.core.UIComponent;
			import mx.managers.PopUpManager;
			
			private const CLOSE:String = "CLOSE";
			
			public function RemovePopBox():void
			{
				RemoveModalPopBox();
				RemoveCanvasPopBox();
			}
			
			// modal
			private var m_uiComponentModal:UIComponent;
			
			public function AddModalPopUp(p_uiComponent:UIComponent):String
			{
				Logger.Instance.WriteInformation("AddModalPopUp:" + p_uiComponent.toString(), flash.utils.getQualifiedClassName(this));

				if (m_uiComponentModal == null)
				{
					Logger.Instance.WriteCritical("Duplicate Modal popbox", "", flash.utils.getQualifiedClassName(this));
					return ResultCode.FAILED;
				}
				else
				{
					m_uiComponentModal = p_uiComponent;
					
					m_uiComponentModal.addEventListener(CLOSE, m_uiComponentModal_CLOSE, false, 0, true);
					PopUpManager.addPopUp(m_uiComponentModal, this, true);
					PopUpManager.centerPopUp(m_uiComponentModal);
					
					return ResultCode.SUCCESS;
				}
			}
			private function m_uiComponentModal_CLOSE(event:Event):void
			{
				Logger.Instance.WriteEvent(event, flash.utils.getQualifiedClassName(this));

				RemoveModalPopBox();
			}
			public function RemoveModalPopBox():void
			{
				Logger.Instance.WriteInformation("RemoveModalPopBox:" + m_uiComponentModal.toString(), flash.utils.getQualifiedClassName(this));
				
				PopUpManager.removePopUp(m_uiComponentModal);
				m_uiComponentModal.removeEventListener(CLOSE, m_uiComponentModal_CLOSE);
				m_uiComponentModal = null;
				
				dispatchEvent(new Event(CLOSE));
			}
			
			// canvas
			private var m_uiComponentNotModal:UIComponent;
			private var m_uiComponentMember:UIComponent;
			private var m_uiComponentBalloon:UIComponent;
			
			public function AddNotModalPopUp(p_uiComponent:UIComponent):void
			{
				m_uiComponentNotModal = p_uiComponent;
				
				m_uiComponentNotModal.addEventListener(CLOSE, m_uiComponentNotModal_CLOSE, false, 0, true);
				CenterPopBox(m_uiComponentNotModal);
				this.addElement(m_uiComponentNotModal);
			}
			private function m_uiComponentNotModal_CLOSE(event:Event):void
			{
				Logger.Instance.WriteEvent(event, flash.utils.getQualifiedClassName(this));
				
				RemoveNotModalPopBox();
			}
			
			private function CenterPopBox(p_uiComponent:UIComponent):void
			{
				p_uiComponent.left = (this.width - p_uiComponent.width) / 2;
				p_uiComponent.top = (this.height - p_uiComponent.height) / 2;
			}
			
			private function RemoveCanvasPopBox():void
			{
			}
			private function RemoveNotModalPopBox():void
			{
				Logger.Instance.WriteInformation("RemoveNotModalPopBox:" + m_uiComponentNotModal.toString(), flash.utils.getQualifiedClassName(this));
				
				this.removeElement(m_uiComponentNotModal);
				m_uiComponentNotModal.removeEventListener(CLOSE, m_uiComponentNotModal_CLOSE);
				m_uiComponentNotModal = null;
			}
		]]>
	</fx:Script>
</mx:Canvas>